<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- saved from url=(0055)http://eurekastatistics.com/_embeds/survival/index.html -->
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Survival Curve Grapher</title>
  <link rel="stylesheet" href="css/main.css" type="text/css">
  <script type="text/javascript" src="js/jquery.min.js"></script>
  <script type="text/javascript" src="js/d3.v3.min.js" charset="utf-8"></script>
  <script type="text/javascript" src="js/array-utils.js" charset="utf-8"></script>
  <script type="text/javascript" src="js/kaplan-meier.js" charset="utf-8"></script>
  <!-- <script type="text/javascript" src="js/test.js"></script> -->
  <script type="text/javascript">
            $("document").ready(function () {
              $("#Age").click(getAge);
              $("#Gender").click(getGender);
              $("#Race").click(getRace);
              $("#Histological").click(getHistological);
            })
            function getAge() {
              $.get("db/above_age.php",function(data){
                var eventSel = $("#eventSel");
                var timeSel = $("#timeSel");
                var groupSel = $("#groupSel");
                for( var item in data ) {
                  eventSel.append(data[item][0]).append("\n");
                  timeSel.append(data[item][1]).append("\n");
                  groupSel.append("above_median_age").append("\n");
                }
                $.get("db/below_age.php",function(data){
                  for( var item in data ) {
                    eventSel.append(data[item][0]).append("\n");
                    timeSel.append(data[item][1]).append("\n");
                    groupSel.append("below_median_age").append("\n");
                  }
                },"json");
              },"json");
            }
            function getGender() {
              $.get("db/getclinical_info.php",function(data){
                var eventSel = $("#eventSel");
                var timeSel = $("#timeSel");
                var groupSel = $("#groupSel");
                for( var item in data ) {
                  eventSel.append(data[item][0]).append("\n");
                  timeSel.append(data[item][1]).append("\n");
                  groupSel.append("male").append("\n");
                }
                $.get("db/getclinical_info.php",function(data){
                  for( var item in data ) {
                    eventSel.append(data[item][0]).append("\n");
                    timeSel.append(data[item][1]).append("\n");
                    groupSel.append("female").append("\n");
                  }
                },"json");
              },"json");
            }
            function getRace() {
              $.get("db/race_white.php",function(data){
                var eventSel = $("#eventSel");
                var timeSel = $("#timeSel");
                var groupSel = $("#groupSel");
                for( var item in data ) {
                  eventSel.append(data[item][0]).append("\n");
                  timeSel.append(data[item][1]).append("\n");
                  groupSel.append("white").append("\n");
                }
                $.get("db/race_Black_orAfricanAmerican.php",function(data){
                  for( var item in data ) {
                    eventSel.append(data[item][0]).append("\n");
                    timeSel.append(data[item][1]).append("\n");
                    groupSel.append("Black_or_AfricanAmerican").append("\n");
                  }
                },"json");
                $.get("db/race_Asian.php",function(data){
                  for( var item in data ) {
                    eventSel.append(data[item][0]).append("\n");
                    timeSel.append(data[item][1]).append("\n");
                    groupSel.append("Asian").append("\n");
                  }
                },"json");
                $.get("db/race_AmericanIndian_orAlaskanative.php",function(data){
                  for( var item in data ) {
                    eventSel.append(data[item][0]).append("\n");
                    timeSel.append(data[item][1]).append("\n");
                    groupSel.append("American_Indian_orAlaskanative").append("\n");
                  }
                },"json");
              },"json");
            }

            function getHistological() {
              $.get("db/oligoastrocytoma.php",function(data){
                var eventSel = $("#eventSel");
                var timeSel = $("#timeSel");
                var groupSel = $("#groupSel");
                for( var item in data ) {
                  eventSel.append(data[item][0]).append("\n");
                  timeSel.append(data[item][1]).append("\n");
                  groupSel.append("oligoastrocytoma").append("\n");
                }
                $.get("db/astrocytoma.php",function(data){
                  for( var item in data ) {
                    eventSel.append(data[item][0]).append("\n");
                    timeSel.append(data[item][1]).append("\n");
                    groupSel.append("astrocytoma").append("\n");
                  }
                },"json");
                $.get("db/oligodendroglioma.php",function(data){
                  for( var item in data ) {
                    eventSel.append(data[item][0]).append("\n");
                    timeSel.append(data[item][1]).append("\n");
                    groupSel.append("oligodendroglioma").append("\n");
                  }
                },"json");
                $.get("db/glioblastoma_multiforme_gbm.php",function(data){
                  for( var item in data ) {
                    eventSel.append(data[item][0]).append("\n");
                    timeSel.append(data[item][1]).append("\n");
                    groupSel.append("glioblastoma_multiforme_gbm").append("\n");
                  }
                },"json");
                $.get("db/treated_primary_gbm.php",function(data){
                  for( var item in data ) {
                    eventSel.append(data[item][0]).append("\n");
                    timeSel.append(data[item][1]).append("\n");
                    groupSel.append("treated_primary_gbm").append("\n");
                  }
                },"json");
                $.get("db/untreated_primary_gbm.php",function(data){
                  for( var item in data ) {
                    eventSel.append(data[item][0]).append("\n");
                    timeSel.append(data[item][1]).append("\n");
                    groupSel.append("untreated_primary_gbm").append("\n");
                  }
                },"json");
                $.get("db/radiation_therapy_Is_yes.php",function(data){
                  for( var item in data ) {
                    eventSel.append(data[item][0]).append("\n");
                    timeSel.append(data[item][1]).append("\n");
                    groupSel.append("radiation_therapy_Is_yes").append("\n");
                  }
                },"json");
              },"json");
            }
  </script>
</head>
<body>
  <div id="viz">
    <svg width="600" height="470">
      <g><g class="axis" transform="translate(0,420)"><g class="tick" transform="translate(50,0)" style="opacity: 1;"><line y2="6" x2="0"></line><text dy=".71em" y="9" x="0" style="text-anchor: middle;">0</text></g><g class="tick" transform="translate(100.5050505050505,0)" style="opacity: 1;"><line y2="6" x2="0"></line><text dy=".71em" y="9" x="0" style="text-anchor: middle;">1</text></g><g class="tick" transform="translate(151.010101010101,0)" style="opacity: 1;"><line y2="6" x2="0"></line><text dy=".71em" y="9" x="0" style="text-anchor: middle;">2</text></g><g class="tick" transform="translate(201.5151515151515,0)" style="opacity: 1;"><line y2="6" x2="0"></line><text dy=".71em" y="9" x="0" style="text-anchor: middle;">3</text></g><g class="tick" transform="translate(252.02020202020202,0)" style="opacity: 1;"><line y2="6" x2="0"></line><text dy=".71em" y="9" x="0" style="text-anchor: middle;">4</text></g><g class="tick" transform="translate(302.52525252525254,0)" style="opacity: 1;"><line y2="6" x2="0"></line><text dy=".71em" y="9" x="0" style="text-anchor: middle;">5</text></g><g class="tick" transform="translate(353.030303030303,0)" style="opacity: 1;"><line y2="6" x2="0"></line><text dy=".71em" y="9" x="0" style="text-anchor: middle;">6</text></g><g class="tick" transform="translate(403.5353535353536,0)" style="opacity: 1;"><line y2="6" x2="0"></line><text dy=".71em" y="9" x="0" style="text-anchor: middle;">7</text></g><g class="tick" transform="translate(454.04040404040404,0)" style="opacity: 1;"><line y2="6" x2="0"></line><text dy=".71em" y="9" x="0" style="text-anchor: middle;">8</text></g><g class="tick" transform="translate(504.54545454545456,0)" style="opacity: 1;"><line y2="6" x2="0"></line><text dy=".71em" y="9" x="0" style="text-anchor: middle;">9</text></g><path class="domain" d="M50,6V0H550V6"></path></g><g class="axis" transform="translate(50,0)"><g class="tick" transform="translate(0,420)" style="opacity: 1;"><line x2="-6" y2="0"></line><text dy=".32em" x="-9" y="0" style="text-anchor: end;">0.0</text></g><g class="tick" transform="translate(0,380.5)" style="opacity: 1;"><line x2="-6" y2="0"></line><text dy=".32em" x="-9" y="0" style="text-anchor: end;">0.1</text></g><g class="tick" transform="translate(0,341)" style="opacity: 1;"><line x2="-6" y2="0"></line><text dy=".32em" x="-9" y="0" style="text-anchor: end;">0.2</text></g><g class="tick" transform="translate(0,301.5)" style="opacity: 1;"><line x2="-6" y2="0"></line><text dy=".32em" x="-9" y="0" style="text-anchor: end;">0.3</text></g><g class="tick" transform="translate(0,262)" style="opacity: 1;"><line x2="-6" y2="0"></line><text dy=".32em" x="-9" y="0" style="text-anchor: end;">0.4</text></g><g class="tick" transform="translate(0,222.5)" style="opacity: 1;"><line x2="-6" y2="0"></line><text dy=".32em" x="-9" y="0" style="text-anchor: end;">0.5</text></g><g class="tick" transform="translate(0,183)" style="opacity: 1;"><line x2="-6" y2="0"></line><text dy=".32em" x="-9" y="0" style="text-anchor: end;">0.6</text></g><g class="tick" transform="translate(0,143.5)" style="opacity: 1;"><line x2="-6" y2="0"></line><text dy=".32em" x="-9" y="0" style="text-anchor: end;">0.7</text></g><g class="tick" transform="translate(0,103.99999999999999)" style="opacity: 1;"><line x2="-6" y2="0"></line><text dy=".32em" x="-9" y="0" style="text-anchor: end;">0.8</text></g><g class="tick" transform="translate(0,64.5)" style="opacity: 1;"><line x2="-6" y2="0"></line><text dy=".32em" x="-9" y="0" style="text-anchor: end;">0.9</text></g><g class="tick" transform="translate(0,25)" style="opacity: 1;"><line x2="-6" y2="0"></line><text dy=".32em" x="-9" y="0" style="text-anchor: end;">1.0</text></g><path class="domain" d="M-6,25H0V420H-6"></path></g><text text-anchor="end" x="300" y="458">Time(year)</text><text text-anchor="end" x="-160" dy=".75em" transform="rotate(-90)">Probability</text><path class="survarea survarea0" d="M50,102.81160869905484L60.101010101010104,102.81160869905484L60.101010101010104,183.92089651264976L65.15151515151516,183.92089651264976L65.15151515151516,217.42304852210208L90.40404040404042,217.42304852210208L90.40404040404042,248.15040697450476L95.45454545454545,248.15040697450476L95.45454545454545,276.60151169868124L100.5050505050505,276.60151169868124L100.5050505050505,303.03002936181906L140.9090909090909,303.03002936181906L140.9090909090909,327.5441607570484L171.2121212121212,327.5441607570484L171.2121212121212,350.1404870066163L196.46464646464648,350.1404870066163L196.46464646464648,370.7017526425984L211.61616161616163,370.7017526425984L211.61616161616163,388.9561967312533L302.52525252525254,388.9561967312533L302.52525252525254,404.35923561873983L509.5959595959595,404.35923561873983L509.5959595959595,415.7319215194723L524.7474747474747,415.7319215194723L524.7474747474747,420L524.7474747474747,233.48845341079118L509.5959595959595,233.48845341079118L509.5959595959595,216.4176432908553L302.52525252525254,216.4176432908553L302.52525252525254,189.21599446808474L211.61616161616163,189.21599446808474L211.61616161616163,161.63919862020654L196.46464646464648,161.63919862020654L196.46464646464648,135.12615667577754L171.2121212121212,135.12615667577754L171.2121212121212,110.03955514460147L140.9090909090909,110.03955514460147L140.9090909090909,86.52765844785355L100.5050505050505,86.52765844785355L100.5050505050505,64.71774159531591L95.45454545454545,64.71774159531591L95.45454545454545,44.789804546182204L90.40404040404042,44.789804546182204L90.40404040404042,27.04023208968112L65.15151515151516,27.04023208968112L65.15151515151516,25L60.101010101010104,25L60.101010101010104,25L50,25"></path><path class="survarea survarea1" d="M50,188.20686198043978L70.20202020202021,188.20686198043978L70.20202020202021,244.33478939140267L100.5050505050505,244.33478939140267L100.5050505050505,291.29355808756685L236.8686868686869,291.29355808756685L236.8686868686869,331.4424724336261L282.3232323232323,331.4424724336261L282.3232323232323,331.4424724336261L312.62626262626264,331.4424724336261L312.62626262626264,378.7653418600186L317.67676767676767,378.7653418600186L317.67676767676767,409.5586127530483L398.4848484848485,409.5586127530483L398.4848484848485,420L398.4848484848485,73.02566236167789L317.67676767676767,73.02566236167789L317.67676767676767,68.5584129993307L312.62626262626264,68.5584129993307L312.62626262626264,51.80949477289448L282.3232323232323,51.80949477289448L282.3232323232323,51.80949477289448L236.8686868686869,51.80949477289448L236.8686868686869,25L100.5050505050505,25L100.5050505050505,25L70.20202020202021,25L70.20202020202021,25L50,25"></path><path class="survarea survarea2" d="M70.20202020202021,127.00789981114798L85.35353535353535,127.00789981114798L85.35353535353535,158.9581414867128L105.55555555555556,158.9581414867128L105.55555555555556,187.95311901992767L125.75757575757575,187.95311901992767L125.75757575757575,214.85122856665868L191.4141414141414,214.85122856665868L191.4141414141414,240.08383805535541L262.1212121212121,240.08383805535541L262.1212121212121,263.8928391143918L282.3232323232323,263.8928391143918L282.3232323232323,286.4169775443294L342.92929292929296,286.4169775443294L342.92929292929296,307.7286833289928L398.4848484848485,307.7286833289928L398.4848484848485,327.8499201735811L413.6363636363636,327.8499201735811L413.6363636363636,364.3720598151157L484.3434343434343,364.3720598151157L484.3434343434343,380.5513773879215L494.44444444444446,380.5513773879215L494.44444444444446,395.03713111310645L509.5959595959595,395.03713111310645L509.5959595959595,413.78944381868826L550,413.78944381868826L550,420L550,224.40922307316427L509.5959595959595,224.40922307316427L509.5959595959595,225.35450245651907L494.44444444444446,225.35450245651907L494.44444444444446,201.0300661526217L484.3434343434343,201.0300661526217L484.3434343434343,177.37062574165557L413.6363636363636,177.37062574165557L413.6363636363636,132.924114729194L398.4848484848485,132.924114729194L398.4848484848485,112.24330702206106L342.92929292929296,112.24330702206106L342.92929292929296,92.63661573512829L282.3232323232323,92.63661573512829L282.3232323232323,74.16135321993649L262.1212121212121,74.16135321993649L262.1212121212121,56.91229673485301L191.4141414141414,56.91229673485301L191.4141414141414,41.04301180816971L125.75757575757575,41.04301180816971L125.75757575757575,26.805605459494412L105.55555555555556,26.805605459494412L105.55555555555556,25L85.35353535353535,25L85.35353535353535,25L70.20202020202021,25"></path><path class="survarea survarea3" d="M50,164.22712146291272L55.05050505050505,164.22712146291272L55.05050505050505,181.79085463949878L60.101010101010104,181.79085463949878L60.101010101010104,215.00440421893106L65.15151515151516,215.00440421893106L65.15151515151516,230.80781343847906L70.20202020202021,230.80781343847906L70.20202020202021,275.5027369345862L75.25252525252526,275.5027369345862L75.25252525252526,303.2256962417354L80.3030303030303,303.2256962417354L80.3030303030303,316.4814429564739L90.40404040404042,316.4814429564739L90.40404040404042,329.3248410524336L115.65656565656568,329.3248410524336L115.65656565656568,341.7403743330309L135.85858585858585,341.7403743330309L135.85858585858585,353.7036338210866L201.5151515151515,353.7036338210866L201.5151515151515,365.1787848659221L211.61616161616163,365.1787848659221L211.61616161616163,365.1787848659221L236.8686868686869,365.1787848659221L236.8686868686869,378.40935500042224L317.67676767676767,378.40935500042224L317.67676767676767,390.5373389710842L327.77777777777777,390.5373389710842L327.77777777777777,390.5373389710842L337.8787878787879,390.5373389710842L337.8787878787879,405.69747837412234L443.93939393939394,405.69747837412234L443.93939393939394,416.24624665159496L464.1414141414141,416.24624665159496L464.1414141414141,416.24624665159496L464.1414141414141,279.20403115544525L464.1414141414141,279.20403115544525L443.93939393939394,279.20403115544525L443.93939393939394,272.19016525423507L337.8787878787879,272.19016525423507L337.8787878787879,258.55429586753075L327.77777777777777,258.55429586753075L327.77777777777777,258.55429586753075L317.67676767676767,258.55429586753075L317.67676767676767,241.30070748640287L236.8686868686869,241.30070748640287L236.8686868686869,224.77639726625193L211.61616161616163,224.77639726625193L211.61616161616163,224.77639726625193L201.5151515151515,224.77639726625193L201.5151515151515,209.14925001291934L135.85858585858585,209.14925001291934L135.85858585858585,193.93561189362183L115.65656565656568,193.93561189362183L115.65656565656568,179.12231136938783L90.40404040404042,179.12231136938783L90.40404040404042,164.6992672035933L80.3030303030303,164.6992672035933L80.3030303030303,150.66046483862183L75.25252525252526,150.66046483862183L75.25252525252526,123.73431585699753L70.20202020202021,123.73431585699753L70.20202020202021,86.3588980055567L65.15151515151516,86.3588980055567L65.15151515151516,74.78840025944842L60.101010101010104,74.78840025944842L60.101010101010104,53.23620223818921L55.05050505050505,53.23620223818921L55.05050505050505,43.40981313825165L50,43.40981313825165"></path><path class="survline survline3" d="M50,25L50,25L50,109.64285714285714L55.05050505050505,109.64285714285714L55.05050505050505,124.42176870748301L60.101010101010104,124.42176870748301L60.101010101010104,153.97959183673473L65.15151515151516,153.97959183673473L65.15151515151516,168.75850340136057L70.20202020202021,168.75850340136057L70.20202020202021,213.09523809523813L75.25252525252526,213.09523809523813L75.25252525252526,242.65306122448982L80.3030303030303,242.65306122448982L80.3030303030303,257.4319727891157L90.40404040404042,257.4319727891157L90.40404040404042,272.2108843537415L115.65656565656568,272.2108843537415L115.65656565656568,286.98979591836735L135.85858585858585,286.98979591836735L135.85858585858585,301.76870748299325L201.5151515151515,301.76870748299325L201.5151515151515,316.54761904761904L211.61616161616163,316.54761904761904L211.61616161616163,316.54761904761904L236.8686868686869,316.54761904761904L236.8686868686869,333.78968253968253L317.67676767676767,333.78968253968253L317.67676767676767,351.03174603174597L327.77777777777777,351.03174603174597L327.77777777777777,351.03174603174597L337.8787878787879,351.03174603174597L337.8787878787879,374.021164021164L443.93939393939394,374.021164021164L443.93939393939394,397.010582010582L464.1414141414141,397.010582010582L464.1414141414141,397.010582010582"></path><circle class="survcircle survcircle3" cx="327.77777777777777" cy="351.03174603174597" r="3"></circle><circle class="survcircle survcircle3" cx="464.1414141414141" cy="397.010582010582" r="3"></circle><path class="survline survline0" d="M50,25L50,25L50,53.2142857142857L60.101010101010104,53.2142857142857L60.101010101010104,109.64285714285714L65.15151515151516,109.64285714285714L65.15151515151516,137.85714285714286L90.40404040404042,137.85714285714286L90.40404040404042,166.07142857142856L95.45454545454545,166.07142857142856L95.45454545454545,194.28571428571428L100.5050505050505,194.28571428571428L100.5050505050505,222.5L140.9090909090909,222.5L140.9090909090909,250.71428571428572L171.2121212121212,250.71428571428572L171.2121212121212,278.92857142857144L196.46464646464648,278.92857142857144L196.46464646464648,307.1428571428571L211.61616161616163,307.1428571428571L211.61616161616163,335.35714285714283L302.52525252525254,335.35714285714283L302.52525252525254,363.57142857142856L509.5959595959595,363.57142857142856L509.5959595959595,391.7857142857143L524.7474747474747,391.7857142857143L524.7474747474747,420"></path><path class="survline survline1" d="M50,25L50,25L50,103.99999999999999L70.20202020202021,103.99999999999999L70.20202020202021,149.14285714285708L100.5050505050505,149.14285714285708L100.5050505050505,194.28571428571425L236.8686868686869,194.28571428571425L236.8686868686869,239.4285714285714L282.3232323232323,239.4285714285714L282.3232323232323,239.4285714285714L312.62626262626264,239.4285714285714L312.62626262626264,299.6190476190476L317.67676767676767,299.6190476190476L317.67676767676767,359.8095238095238L398.4848484848485,359.8095238095238L398.4848484848485,420"></path><circle class="survcircle survcircle1" cx="50" cy="103.99999999999999" r="3"></circle><circle class="survcircle survcircle1" cx="282.3232323232323" cy="239.4285714285714" r="3"></circle><path class="survline survline2" d="M50,25L70.20202020202021,25L70.20202020202021,71.47058823529413L85.35353535353535,71.47058823529413L85.35353535353535,94.70588235294119L105.55555555555556,94.70588235294119L105.55555555555556,117.94117647058826L125.75757575757575,117.94117647058826L125.75757575757575,141.17647058823528L191.4141414141414,141.17647058823528L191.4141414141414,164.41176470588235L262.1212121212121,164.41176470588235L262.1212121212121,187.64705882352942L282.3232323232323,187.64705882352942L282.3232323232323,210.8823529411765L342.92929292929296,210.8823529411765L342.92929292929296,234.1176470588235L398.4848484848485,234.1176470588235L398.4848484848485,257.3529411764706L413.6363636363636,257.3529411764706L413.6363636363636,303.8235294117647L484.3434343434343,303.8235294117647L484.3434343434343,327.0588235294117L494.44444444444446,327.0588235294117L494.44444444444446,350.29411764705884L509.5959595959595,350.29411764705884L509.5959595959595,385.1470588235294L550,385.1470588235294L550,420"></path></g>
    </svg>
  </div>
  <div id="message-holder">
    <div id="message" class=""></div>
  </div>
  <div id="inputs-container-container">

    <div class="input-container">
      <div class="legend">Time</div>
      <textarea  rows="10" cols="5" id="timeSel" name="timeSel" ></textarea>
    </div>
    <div class="input-container">
      <div class="legend">Event</div>
        <textarea rows="10" cols="5" id="eventSel" name="eventSel" ></textarea>
    </div>
    <div class="input-container">
      <div class="legend">Group</div>
        <textarea rows="10" cols="5" id="groupSel" name="groupSel" ></textarea>
    </div>
    <!-- <div class="input-container">
      <div class="legend">Group</div>
      <input type="radio" name="gp-type" value="Age">Age<br>
      <input type="radio" name="gp-type" value="Gender" checked="">Gender<br>
      <input type="radio" name="gp-type" value="Race">Race<br>
      <input type="radio" name="gp-type" value="Histological">Histological
    </div> -->

  <div class="input-container">
      <div class="legend">Catagory</div>
       <button name="gp-type" value = "Age" id ="Age">Age</button><br>
       <button name="gp-type" value = "Gender" id ="Gender">Gender</button><br>
       <button name="gp-type" value = "Race" id ="Race">Race</button><br>
       <button name="gp-type" value = "Histological" id ="Histological">Histological</button>

        <!-- <input type ="checkbox" name="gp-type" value = "Age" id ="Age"> Age<br>
        <input type ="checkbox" name="gp-type" value = "Gender" id ="Gender" checked=""> Gender<br>
        <input type ="checkbox" name="gp-type" value = "Race" id ="Race"> Race<br>
        <input type ="checkbox" name="gp-type" value = "Histological" id ="Histological"> Histological<br>
        <input type ="checkbox" name="gp-type" value = "all" id ="all"> All -->
   </div>

    <div class="input-container">
      <div class="legend">CI Type</div>
      <input type="radio" name="ci-type" value="ordinary">Ordinary<br>
      <input type="radio" name="ci-type" value="log" checked="">Log<br>
      <input type="radio" name="ci-type" value="loglog">Log-Log<br>
      <input type="radio" name="ci-type" value="none">None
    </div><!-- input-container -->

    <div class="input-container">
        <div class="legend">CI</div>
        <input type="radio" name="ci" value="0.67449">50%<br>
        <input type="radio" name="ci" value="1.28155">80%<br>
        <input type="radio" name="ci" value="1.64485">90%<br>
        <input type="radio" name="ci" value="1.95996" checked="">95%
    </div><!-- input-container -->

    <div class="input-container">
        <div class="legend"><br></div>
       <button type="button" onclick="getInputDataAndDrawKM();">Redraw</button>
    </div><!-- input-container -->
    <div id="instructions">
        <ul>
            <li>Time values must be supplied.</li>
            <li>Event flags need not be supplied. Acceptable flags: 1 for event, 0 for censoring. If not supplied, all time points are events (i.e. no censoring).</li>
            <li>Groups need not be supplied.</li>
            <li>Hover over a survival curve to get its group name and to see its confidence interval.</li>
        </ul>
    </div>
  </div><!-- inputs-container-container -->
  <script type="text/javascript">
  /**
 * Checks whether the user is using Internet Explorer.
 */
    function isIE(){
    	var ms_ie = false;
    	var ua = window.navigator.userAgent;
    	var old_ie = ua.indexOf('MSIE ');
    	var new_ie = ua.indexOf('Trident/');

    	if ((old_ie > -1) || (new_ie > -1)) ms_ie = true;

    	return ms_ie;
    }






    // Functions to deal with messages for the user.
    function message(s){$("#message").html(s).addClass("active");}
    function clearMessage(){$("#message").html("").removeClass("active");}
    // Functions to highlight or dehighlight textareas.
    /////////////////////////////////////////////////////////testkp1
// function highlightTimesData(){$("#timesdata"    ).css({'background-color' : 'rgba(255, 0, 0, 0.4)'});}
    function highlightTimesData(){$("#timeSel"    ).css({'background-color' : 'rgba(255, 0, 0, 0.4)'});}
    function highlightEventData(){$("#eventSel").css({'background-color' : 'rgba(255, 0, 0, 0.4)'});}
    function highlightGroupData(){$("#groupSel"    ).css({'background-color' : 'rgba(255, 0, 0, 0.4)'});}
    function dehighlight(){
        $("#timeSel" ).css({'background-color' : 'rgba(255, 255, 255, 1)'});
        $("#eventSel").css({'background-color' : 'rgba(255, 255, 255, 1)'});
        $("#groupSel").css({'background-color' : 'rgba(255, 255, 255, 1)'});
    }
    d3.selection.prototype.moveToFront = function(){
        return this.each(function(){
            this.parentNode.appendChild(this);
        });
    };
/**
 * Reads and checks for errors the data supplied in the form and then graphs it.
 */
    function getInputDataAndDrawKM(){
        // Parameters.
        var id = "#viz", width = 600, height = 470, margin = 50;

        // Get the data from the input box and draw the Kaplan Meier plot.
        var inputData = getInputData();
        if (typeof(inputData) == "string"){
            // We've got an error message. The user supplied incorrectly formatted data.
            message(inputData);
        }
        else{
    		clearMessage();
            if (d3.select("svg") != false){
                d3.select("svg").remove();
            }
            var vis = d3.select(id)
                        .append("svg:svg")
                        .attr("width",  width)
                        .attr("height", height);
            var g = vis.append("svg:g");

            // Create the scaling transformations for the two axes.
            var xTransform = d3.scale.linear()
                                     .domain([0, d3.max(inputData.times)])
                                     .range([0 + margin, width - margin]);
            var yTransform = d3.scale.linear()
                                     .domain([1, 0])
                                     .range([0 + margin/2, height - margin]);

            // X-axis.
            var xAxis = d3.svg.axis().scale(xTransform).orient("bottom");
            g.append("g")
             .attr("class", "axis")
             .attr("transform", "translate(0," + (height - margin) + ")")
             .call(xAxis);

            // Y-axis.
            var yAxis = d3.svg.axis().scale(yTransform).orient("left");
            g.append("g")
             .attr("class", "axis")
             .attr("transform", "translate(" + margin + ",0)")
             .call(yAxis);

            // X-axis label.
            g.append("text")
             .attr("text-anchor", "end")
             .attr("x", width / 2)
             .attr("y", height - 12)
             .text("Time");

            // Y-axis label.
            g.append("text")
             .attr("text-anchor", "end")
             .attr("x", -160)
             .attr("dy", ".75em")
             .attr("transform", "rotate(-90)")
             .text("Probability");

            // Draw the survival estimates and confidence intervals. The confidence intervals must be drawn first, otherwise
            // they will obscure the lines, preventing the mouseover effects defined on the survival estimates (the lines).
            groups = unique(inputData.groups);
            // console.log(groups);
    		if (inputData.ciType != "none"){
    			for (var igrp = 0; igrp < groups.length; igrp++){
            // console.log(groups.length);
    				var cmp = compare(x=inputData.groups, operator="eq", val=groups[igrp]);
    				drawKMCI(g, subset(inputData.times, cmp), subset(inputData.events, cmp), inputData.z, inputData.ciType, xTransform, yTransform, igrp);
    			}
    		}
            for (var igrp = 0; igrp < groups.length; igrp++){
                var cmp = compare(x=inputData.groups, operator="eq", val=groups[igrp]);
                var groupName = subset(inputData.groups, cmp)[0];
                drawKM(g, subset(inputData.times, cmp), subset(inputData.events, cmp), xTransform, yTransform, igrp, groupName);
            }
        }
    }
/**
 * Reads and checks for errors the data supplied in the form.
 * Returns:
 *  * "times":  Array of event or censoring times (non-negative ints or floats).
 *  * "events": Array of Booleans (true for event, false for censoring). This array will be the same length as the array of times.
 *  * "groups": Array of strings. Will be of zero length if no groups were supplied. Otherwise this array will be
 *              the same length as the array of times and events.
 *  * "ciType": "ordinary", "log", "loglog" or "none".
 *  * "z":      The z-score to use for the confidence intervals, e.g. 1.96.
 */
    function getInputData(){
        // Remove any highlighting from the input boxes.
        dehighlight();
        // Get the (required) event/censoring times.
        var times = getTextareaData("timeSel");
        // if (typeof(times) == "string"){
        //     highlightTimesData();
        //     return times;
        // }
        // if (times.length == 0){
        //     highlightTimesData();
        //     return "Event/censoring times must be supplied.";
        // }
        // Get the (optional) event/censoring flags.
        var events = getTextareaData("eventSel");
        if (typeof(events) == "string"){
            highlightEventData();
            return events;
        }
        if (0  < events.length && events.length != times.length){
            highlightEventData();
            return "There must be as many event/censoring times as event/censoring flags.";
        }
        if (0 == events.length) events = rep(1, times.length);
        // Get the (optional) groups.
        var groups = getTextareaData("groupSel");
        if (typeof(groups) == "string"){
            highlightGroupData();
            return groups;
        }
        if (0  < groups.length && groups.length != times.length){
            highlightGroupData();
            return "There must be as many event/censoring times as group labels.";
        }
        if (0 == groups.length) groups = rep("Default Group", times.length);

        ciType = $("input[name=ci-type]:checked").val();
        z = Number($("input[name=ci]:checked").val());


        // groupType = ($("input[name=gp-type]:checked").val();

        return {"times" : times,
                "events": events,
                "groups": groups,
                // "groupType":groupType,
                "ciType": ciType,
                "z"     : z};
    }

/**
 * Gets data from a textarea as an array. Returns an error string if there's a problem with the data.
 * textareaID can be "timesdata", "censoringdata" or "groupdata".
 */
    function getTextareaData(textareaID){
        var data = [];

        // Read the data from the textarea.
        var rawData = $('#' + textareaID).val();

        // Remove any "\n" at the end of the string.
        var n = rawData.length;
        if (n > 0 && rawData[n - 1] == "\n") rawData = rawData.substring(0, n - 1);

        if ($.trim(rawData).length > 0){
            // Split the string by line.
            var lines = rawData.split("\n");

            for (var i = 0; i < lines.length; i++) {

                var str = lines[i];

                // Convert all tabs to spaces and trim.
                str = $.trim(str.replace(/\t/g, " "));

                // Return an error string if this is a blank line.
                if (str.length == 0) return("Line " + (i + 1) + " is blank.");

                // Check and convert the data.
                if (inArray(textareaID, ["timeSel", "eventSel"])){
                    var val = Number(str);
                    if (textareaID == "timeSel" && (isNaN(val) || val < 0)){
                        return("Line " + (i + 1) + " is missing a time value (a non-negative number).");
                    }
                    if (textareaID == "eventSel" && (isNaN(val) || !inArray(val, [0, 1]))){
                        return("Line " + (i + 1) + " is missing an event/censor value: 1 for event; 0 for censoring.");
                    }
                    data.push(val);
                }
                else data.push(str);
            }
        }

        return data;
    }

    /**
     * Draws a confidence interval for the Kaplan-Meier estimate of the survival curve obtained from the
     * supplied array of times and events.
     */
    function drawKMCI(g, times, events, z, ciType, xTransform, yTransform, groupNum){
        km = kaplanMeier(times, events);
        if (ciType == "ordinary") ci = ciKaplanMeier(km.kaplanMeier, km.greenwoodSE,       z, ciType);
        if (ciType == "log")      ci = ciKaplanMeier(km.kaplanMeier, km.greenwoodSELog,    z, ciType);
        if (ciType == "loglog")   ci = ciKaplanMeier(km.kaplanMeier, km.greenwoodSELogLog, z, ciType);
        ciLowerStep = stepFnData(km.time, ci[0]);
        ciUpperStep = stepFnData(km.time, ci[1]);
        var lineFunction = d3.svg.line()
                             .x(function(d){return d[0];})
                             .y(function(d){return d[1];})
                             .interpolate("linear");
         // Draw the confidence intervals.
        var areaData = joinArrays(arrayOf2DimArrays(ciLowerStep["x"], ciLowerStep["y"], xTransform, yTransform),
                                  arrayOf2DimArrays(ciUpperStep["x"], ciUpperStep["y"], xTransform, yTransform).reverse());
        g.append("path")
         .attr("class", "survarea survarea" + groupNum)
         .attr("d", lineFunction(areaData));
    }
    /**
     * Draws a Kaplan-Meier estimate of the survival curve obtained from the supplied array of times and events.
     */
    function drawKM(g, times, events, xTransform, yTransform, groupNum, groupName){
        var km = kaplanMeier(times, events);
        var kmStep = stepFnData(joinArrays([0], km.time), joinArrays([1], km.kaplanMeier));
        var lineFunction = d3.svg.line()
                             .x(function(d){return d[0];})
                             .y(function(d){return d[1];})
                             .interpolate("linear");
        var highlight_fn = function(){
    		if (isIE()){
    			// IE doesn't handle z-indexes in D3 very well.
    			d3.selectAll(".survline"   + groupNum).classed("active", true);
    			d3.selectAll(".survcircle" + groupNum).classed("active", true);
    		}
    		else {
    			d3.selectAll(".survline"   + groupNum).classed("active", true).moveToFront();
    			d3.selectAll(".survcircle" + groupNum).classed("active", true).moveToFront();
    		}
            d3.selectAll(".survarea"   + groupNum).classed("active", true);
            message("Highlighted Group:  " + groupName);
        }
        var dehighlight_fn = function(){
            d3.selectAll(".survline"   + groupNum).classed("active", false);
            d3.selectAll(".survcircle" + groupNum).classed("active", false);
            d3.selectAll(".survarea"   + groupNum).classed("active", false);
            clearMessage();
        }

        // Draw the lines.
        g.append("path")
         .attr("class", "survline survline" + groupNum)
         .attr("d", lineFunction(arrayOf2DimArrays(kmStep["x"], kmStep["y"], xTransform, yTransform)))
         .on("mouseover", highlight_fn)
         .on("mouseout",  dehighlight_fn);

        // Draw circles to show censoring.
        var hasCensoring = compare(km.nCensored, "gt", 0)
        g.selectAll("circle")
         .data(arrayOf2DimArrays(subset(km.time, hasCensoring), subset(km.kaplanMeier, hasCensoring), xTransform, yTransform))
         .enter()
         .append("circle")
         .attr("class", "survcircle survcircle" + groupNum)
         .attr("cx", function(d){return d[0];})
         .attr("cy", function(d){return d[1];})
         .attr("r", 3)
         .on("mouseover", highlight_fn)
         .on("mouseout",  dehighlight_fn);
    }

    /**
     * Turns an array of x-axis values and an array of y-axis values into a pair of arrays that give the
     * coordinates of a derived step function.
     * E.g. x=[1, 2] and y=[7, 6] -> [[1, 2, 2], [7, 7, 6]]
     */
    function stepFnData(x, y){
        var stepx = [], stepy = [];
        for (var i = 0; i < x.length; i++){
            if ((i > 0) && !isNaN(y[i-1])){
                stepx.push(x[i]);
                stepy.push(y[i-1]);
            }
            if (!isNaN(y[i])){
                stepx.push(x[i]);
                stepy.push(y[i]);
            }
        }
        return {"x": stepx, "y": stepy};
    }
    getInputDataAndDrawKM();
  </script>
 </body>
</html>
